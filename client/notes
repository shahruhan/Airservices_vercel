// FIREBASE CONFIGURATION
import firebase from 'firebase/compat/app';

const firebaseConfig = {
    apiKey: "AIzaSyAYV3IBu4ITaEv6n670cxVc6dYzB68WxqU",
    authDomain: "babulmadina-9e69c.firebaseapp.com",
    projectId: "babulmadina-9e69c",
    storageBucket: "babulmadina-9e69c.appspot.com",
    messagingSenderId: "100857525786",
    appId: "1:100857525786:web:35da479a32943d30da83a3",
    measurementId: "G-QPVF1XE5WS"
  };

  firebase.initializeApp(firebaseConfig);



const formHandler = (e) => {
  e.preventDefault();
  const file = e.target[0].files[0];
  const url = await uploadFiles(file); // ðŸ‘ˆ wait for upload to be done
  createPost(url); // ðŸ‘ˆ only then create the post with the url
};

                           // ðŸ‘‡ this function is asynchronous, meaning it returns a promise
const uploadFiles = (file) => async {
  if (!file) return;
  const storageRef = ref(storage, `files/${file.name}`);
  const uploadTask = uploadBytesResumable(storageRef, file);

  uploadTask.on(
    "state_changed",
    (snapshot) => {
      const prog = Math.round(
        (snapshot.bytesTransferred / snapshot.totalBytes) * 100
      );
      setProgress(prog);
    },
    (error) => console.log(error)
  );
  await uploadTask; // ðŸ‘ˆ uploadTask is a promise itself, so you can await it
  
  let downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                 // ðŸ‘† getDownloadURL returns a promise too, so... yay more await

  return downloadURL; // ðŸ‘ˆ return the URL to the caller
};


fileRef.put(selectedFile)
                .then(snapshot => {
                    return snapshot.ref.getDownloadURL();   // Will return a promise with the download link
                })

                .then(downloadURL => {
                    console.log(`Successfully uploaded file and got download link - ${downloadURL}`);
                    return downloadURL;
                })

                .catch(error => {
                    // Use to signal error if something goes wrong.
                    console.log(`Failed to upload file and get link - ${error}`);
                });
